{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% if validlink %}{% trans "Установите новый пароль" %}{% else %}{% trans "Ошибка" %}{% endif %}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/password_reset_confirm.css' %}">
{% endblock %}

{% block content %}
<div class="password-reset-confirm-container">
    <div class="password-reset-confirm-card">
        <div class="password-reset-confirm-header {% if not validlink %}error{% endif %}">
            {% if validlink %}
                <h2>{% trans "Установите новый пароль" %}</h2>
            {% else %}
                <h2>{% trans "Ошибка" %}</h2>
            {% endif %}
        </div>
        
        {% if validlink %}
            <div class="password-reset-confirm-message">
                <p>{% trans "Введите новый пароль для вашей учетной записи." %}</p>
            </div>
            
            <form method="post" class="password-reset-confirm-form">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="{{ form.new_password1.id_for_label }}">
                        {{ form.new_password1.label }}
                        {% if form.new_password1.field.required %}<span class="required">*</span>{% endif %}
                    </label>
                    {{ form.new_password1 }}
                    {% if form.new_password1.help_text %}
                        <div class="form-text">{% autoescape off %}{{ form.new_password1.help_text }}{% endautoescape %}</div>
                    {% endif %}
                    {% if form.new_password1.errors %}
                        <div class="error-message">
                            {% for error in form.new_password1.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.new_password2.id_for_label }}">
                        {{ form.new_password2.label }}
                        {% if form.new_password2.field.required %}<span class="required">*</span>{% endif %}
                    </label>
                    {{ form.new_password2 }}
                    {% if form.new_password2.errors %}
                        <div class="error-message">
                            {% for error in form.new_password2.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                {% if form.non_field_errors %}
                    <div class="form-group">
                        <div class="error-message global-error">
                            {% for error in form.non_field_errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <button type="submit" class="password-reset-confirm-btn">
                    {% trans "Сохранить новый пароль" %}
                </button>
            </form>
        {% else %}
            <div class="alert alert-danger">
                <h5>{% trans "Ссылка недействительна" %}</h5>
                <p>
                    {% trans "Возможно, срок действия ссылки истёк, она уже была использована, или вы перешли по неправильной ссылке." %}
                </p>
                <a href="{% url 'users:password_reset' %}" class="btn-outline-primary">
                    {% trans "Запросить новую ссылку" %}
                </a>
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/password_reset_confirm.js' %}"></script>
{% endblock %}